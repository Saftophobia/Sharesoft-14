<!-- 
  # Definition: Creating a title for the page and a side bar to insert the dropdown
  # list, map, and checkboxes in.
  # Input: Void.
  # Output: Page title, map background and menu bar.
  # Author: Heba Abdelfattah.
-->

<!DOCTYPE html>
 <html>
  <body>
   <div class="header" style="background-color:#333333;">
    <style>
     h1 {text-align:center}
    </style>
  <body>
  <h1 style="margin-bottom:0;">STARTUP MAPS</h1></div>
  </body>
  <div id="menu" style="background-color:#333333;height:70%;width:200px;float:right;">

<!-- 
  # Definition: The checkboxes and the dropdown list of the sectors.
  # Input: The url of the actions.
  # Output: Checkboxes with the markers pictures and the dropdown list.
  # Author: Alia Tarek.
-->

   <%=form_for :entities  do |f| %>
    <p>
     <%= f.select :sectors, [['please select a sector...'],['Agriculture','agriculture'],['Manufacturing','manufacturing'],['Trading','trading'],['Clothes','clothes'],['Telecommunications','telecommunications']] %>
    </p>
   <% end %>
   <head>
    <style>
     h3 {text-align:center}
    </style>
    </head>
    <h3><font color = "white">Click To View</font></h3>
    <head>
     <style>
      h5 {text-align:center}
      h5 {text-align:center}
      h5 {text-align:center}
      h3 {text-align:center}
      h5 {text-align:center}
      h5 {text-align:center}
     </style>
    </head>
   <body>
    <h5><p><font color = "white"><label>  <img src = "http://rideforclimate.com/nukes/all/images/yellow.png">  <input type = 'checkbox' id = 'merged' onclick = 'toggleLocations(this, "/maps/1/show_merged");'>Joint Ventures</label></font></p></h5>
    <h5><p><font color = "white"><label><img src = "http://rideforclimate.com/nukes/all/images/orange.png">   <input type = 'checkbox'id = 'investors' onclick = 'toggleLocations(this, "/maps/1/show_investors");'>Investors</label></font></p></h5>
    <h5><p><font color = "white"><label><img src = "http://rideforclimate.com/nukes/all/images/green.png">  <input type = 'checkbox'id = 'services' onclick = 'toggleLocations(this, "/maps/1/show_services");'>Services</label></font></p></h5>
    <head>
     <style>
      h4 {text-align:center}
     </style>
    </head>
    <h4><font color = "white">Startups</font></h4>
    <h5><p><font color = "white"><label>  <img src = "http://rideforclimate.com/nukes/all/images/blue.png">  <input type = 'checkbox' id = 'online' onclick = 'toggleLocations(this, "/maps/1/show_online");'>Online Startups</label></font></p></h5>
    <h5><p><font color = "white"><label>  <img src = "http://rideforclimate.com/nukes/all/images/red.png">  <input type = 'checkbox' id = 'offline' onclick = 'toggleLocations(this, "/maps/1/show_offline");'>Offline Startups</label></font></p></h5>
   </body>
  </html>
 </div>
 <div id="map" style="height:70%;width:70%;float:left;">

<!-- 
  # Definition: The API of the map.
  # Input: Void.
  # Output: Google Map.
  # Author: Alia Tarek.
-->
  <script src="//maps.google.com/maps/api/js?v=3.13&amp;sensor=false&amp;libraries=geometry" type="text/javascript"></script>
  <script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js' type='text/javascript'></script>
 </div>

<!-- 
  # Definition: The method that calls the markers.
  # Input: Name of the action and the id of the checkbox.
  # Output: The markers on the map.
  # Author: Alia Tarek.
-->
 <script>
  var locationsMap = {};
  var x = 3;
  function toggleLocations(cb, url){
   var id= cb.id;
   if(!cb.checked){
    locationsMap[id] = [];
    buildMap();
    x = 2;
   }
   else{
    x = 10;
    url = url + "?sector=" + getSector();
    $.ajax(url)
    .done(function(data) {
     locationsMap[id] = data;
     buildMap();
     if (locationsMap[id] == "" )
     {alert("No result found")} 
    })
    .fail(function(data) {
     alert.log( "error" );
    });
   }
  };
  function getSector(){
   var skillsSelect = document.getElementById("entities_sectors");
   var selectedText = skillsSelect.options[skillsSelect.selectedIndex].text;
   return selectedText;
  }
  function isChecked(id){
   if (document.getElementById(id).checked){
    return id + ',';
   }
    return '';
   }
 </script>

<!-- 
  # Definition: The Mapbuilder.
  # Input: Arrays of the markers.
  # Output: Map with the markers.
  # Author: Alia Tarek.
-->

 <script type = "text/javascript">
  locationsMap["investors"] = [];
  locationsMap["services"] = [];
  locationsMap["online"] = [];
  locationsMap["offline"] = [];
  locationsMap["merged"] = [];
  function buildMap (){
   handler = Gmaps.build('Google');
   handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
    var loc1 = locationsMap["online"]
     .concat(locationsMap["offline"]);
    var loc2 = loc1.concat(locationsMap["investors"]);
    var loc3 = loc2.concat(locationsMap["services"]);
    var loc4 = loc3.concat(locationsMap["merged"]);
    markers = handler.addMarkers(loc4);  
    handler.bounds.extendWith(markers);
    handler.fitMapToBounds();
    handler.getMap().setZoom(x);
   }); 
 }
   buildMap();
 </script>
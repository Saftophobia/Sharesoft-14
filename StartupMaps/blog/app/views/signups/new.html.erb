
<script src="//maps.google.com/maps/api/js?v=3.13&amp;sensor=false&amp;libraries=geometry" type="text/javascript"></script>
<script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js' type='text/javascript'></script>  

<div style='width: 800px;'>
  <div id="multi_markers" style='width: 600px; height: 600px;'></div>
</div> 

<script type = "text/javascript">

var handler = Gmaps.build('Google');
handler.buildMap({ provider: { }, internal: {id: 'multi_markers'}}, function(){
  msrkers = handler.addMarkers(<%=raw @hash.to_json %>);
  markers = handler.addMarkers([
    { lat: 32, lng: 25},
    { lat: 22, lng: 25},
    { lat: 22, lng: 35},
    { lat: 31.75, lng: 34.05},  
  ]);
  handler.bounds.extendWith(markers);
  handler.fitMapToBounds();

  var json_data = [
    {
      id:  1,
      lat: 27,
      lng: 30,
      infowindow: "<div style='color:red;'>Your Startup</div>" //this html is properly disaplayed
    }
  ];

  //create draggable markers (pass google maps options aas a second arg)
  var markers = handler.addMarkers(json_data, { draggable: true});

  //add markers to original json
  _.each(json_data, function(json, index){
    json.marker = markers[index];
  });

  //add dragend event to markers, triggered when you drop them
  _.each(json_data, function(json){
    google.maps.event.addListener(json.marker.getServiceObject(), "dragend", function(event) {
      var lat = event.latLng.lat();
      var lng = event.latLng.lng();
      console.log('Marker with id: ' + json.id + ' dropped hat lat: ' + lat + ' and lng: ' + lng)
    });
  });
});

</script>